name: step1_interfaces 
version: 2
testcases:
- name: step1_dhcp_listener
  steps:
  - type: http
    method: PATCH
    url: '{{.pfserver_webadmin_url}}/api/v1/configurator/config/interface/{{.configurator.dhcp_listener.interface}}'
    ignore_verify_ssl: true
    body: >-
      {
        "id": "{{.configurator.dhcp_listener.interface}}",
        "ifindex": "2",
        "ipaddress": "{{.configurator.dhcp_listener.ip}}",
        "name": "{{.configurator.dhcp_listener.mac}}",
        "netmask": "{{.configurator.dhcp_listener.mask}}",
        "type": "dhcp-listener"
      }
    assertions:
      - result.statuscode ShouldEqual 200

- name: step1_management_configuration
  steps:
  - type: http
    method: PATCH
    url: '{{.pfserver_webadmin_url}}/api/v1/configurator/config/interface/{{.configurator.management.interface}}'
    ignore_verify_ssl: true
    body: >-
      {
        "additional_listening_daemons": ["portal"],
        "0": "portal",
        "address": "{{.configurator.management.interface.ip.and.mask}}",
        "id": "{{.configurator.management.interface}}",
        "ifindex": "2",
        "ipaddress": "{{.configurator.management.ip}}",
        "name": "{{.configurator.management.interface}}",
        "netmask": "{{.configurator.management.mask}}",
        "network": "{{.configurator.management.network.ip}}",
        "network_iseditable": false,
        "type": "management"
      }
    assertions:
      - result.statuscode ShouldEqual 200

- name: step1_registration_configuration
  steps:
  - type: http
    method: PATCH
    url: '{{.pfserver_webadmin_url}}/api/v1/configurator/config/interface/{{.configurator.registration.interface}}'
    ignore_verify_ssl: true
    body: >-
      {
        "dhcpd_enabled": "enabled",
        "id": "{{.configurator.registration.interface}}",
        "ifindex": "2",
        "ipaddress": "{{.configurator.registration.interface}}",
        "name": "{{{.configurator.registration.interface}}",
        "netmask": "{{.configurator.registration.mask}}",
        "network_iseditable": false,
        "type": "vlan-registration"
      }
    assertions:
      - result.statuscode ShouldEqual 200

- name: step1_isolation_configuration
  steps:
  - type: http
    method: PATCH
    url: '{{.pfserver_webadmin_url}}/api/v1/configurator/config/interface/{{.configurator.isolation.interface}}'
    ignore_verify_ssl: true
    body: >-
      {
        "dhcpd_enabled": "enabled",
        "id": "{{.configurator.isolation.interface}}",
        "ifindex": "7",
        "ipaddress": "{{.configurator_isolation_ip}}",
        "name": "{{.configurator.isolation.interface}}",
        "netmask": "{{.configurator.isolation.ip}}",
        "network_iseditable": false,
        "type": "vlan-isolation"
      }
    assertions:
      - result.statuscode ShouldEqual 200

- name: step1_dns_configuration
  steps:
  - type: http
    method: PUT
    url: '{{.pfserver_webadmin_url}}/api/v1/configurator/config/system/dns_servers'
    ignore_verify_ssl: true
    body: >-
      {
        "dns_servers": ["{{.configurator.dns.ip}}", "{{.configurator.dns_aux.ip}}"],
        "0": "{{.configurator.dns.ip}}",
        "1": "{{.configurator.dns_aux.ip}}"
      }
    assertions:
      - result.statuscode ShouldEqual 200

